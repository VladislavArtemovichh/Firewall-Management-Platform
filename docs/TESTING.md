# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Firewall Management Platform

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
- [–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞](#–ø–æ–∫—Ä—ã—Ç–∏–µ-–∫–æ–¥–∞)
- [–¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤](#—Ç–∏–ø—ã-—Ç–µ—Å—Ç–æ–≤)
- [–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤](#–Ω–∞–ø–∏—Å–∞–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)
- [–ú–æ–∫–∏ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã](#–º–æ–∫–∏-–∏-—Ñ–∏–∫—Å—Ç—É—Ä—ã)
- [–û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤](#–æ—Ç–ª–∞–¥–∫–∞-—Ç–µ—Å—Ç–æ–≤)
- [CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#cicd-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## üéØ –û–±–∑–æ—Ä

Firewall Management Platform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **pytest** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è:

- **Unit —Ç–µ—Å—Ç—ã** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤
- **Integration —Ç–µ—Å—Ç—ã** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **API —Ç–µ—Å—Ç—ã** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è REST API endpoints
- **Database —Ç–µ—Å—Ç—ã** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **Mock —Ç–µ—Å—Ç—ã** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | 64% |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤** | 50+ |
| **–ú–æ–¥—É–ª–∏ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º >90%** | 7 –∏–∑ 11 |
| **–ú–æ–¥—É–ª–∏ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º <60%** | 2 –∏–∑ 11 |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py                 # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã pytest
‚îú‚îÄ‚îÄ test_connections_api.py     # –¢–µ—Å—Ç—ã API —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_database.py           # –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ test_firewall_devices_api.py # –¢–µ—Å—Ç—ã API —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îú‚îÄ‚îÄ test_middleware.py         # –¢–µ—Å—Ç—ã middleware
‚îú‚îÄ‚îÄ test_models.py             # –¢–µ—Å—Ç—ã Pydantic –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ test_network_monitor.py    # –¢–µ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–∏
‚îú‚îÄ‚îÄ test_routes.py             # –¢–µ—Å—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îú‚îÄ‚îÄ test_security.py           # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ test_utils.py              # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
```

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# Python 3.8+
python --version

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pytest>=7.0.0
pytest-asyncio>=0.21.0
pytest-cov>=4.0.0
pytest-mock>=3.10.0
httpx>=0.24.0
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate     # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

---

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v

# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º print() statements
pytest -s

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_database.py::test_connection

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
pytest -k "test_connection"
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç—á–µ—Ç–æ–º –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=app

# –ó–∞–ø—É—Å–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=app --cov-report=term-missing

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
pytest --cov=app --cov-report=html

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è XML –æ—Ç—á–µ—Ç–∞ (–¥–ª—è CI/CD)
pytest --cov=app --cov-report=xml
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest -m "not slow"

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest -m "integration"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
pytest -n auto

# –ó–∞–ø—É—Å–∫ —Å –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest -x

# –ó–∞–ø—É—Å–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—à–∏–±–æ–∫
pytest --maxfail=5
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Makefile

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test-clean
```

---

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|--------|----------|--------|
| `app/__init__.py` | 100% | ‚úÖ |
| `app/middleware.py` | 100% | ‚úÖ |
| `app/models.py` | 100% | ‚úÖ |
| `app/security.py` | 100% | ‚úÖ |
| `app/utils.py` | 100% | ‚úÖ |
| `app/metrics.py` | 98% | ‚úÖ |
| `app/network_monitor.py` | 96% | ‚úÖ |
| `app/firewall_devices_api.py` | 66% | üü° |
| `app/database.py` | 62% | üü° |
| `app/routes.py` | 57% | üî¥ |
| `app/connections_api.py` | 40% | üî¥ |

### –¶–µ–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 75%
- **–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 85%
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏:** 90%+

### –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=app --cov-report=html --cov-report=term-missing

# –ü—Ä–æ—Å–º–æ—Ç—Ä HTML –æ—Ç—á–µ—Ç–∞
open htmlcov/index.html  # Mac
start htmlcov/index.html # Windows
xdg-open htmlcov/index.html  # Linux
```

---

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤:

```python
def test_parse_connection_data():
    """–¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
    data = "tcp 192.168.1.1:80 10.0.0.1:12345 ESTABLISHED"
    result = parse_connection_data(data)
    
    assert result['protocol'] == 'tcp'
    assert result['local_ip'] == '192.168.1.1'
    assert result['local_port'] == 80
```

### 2. Integration —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```python
async def test_database_connection_integration():
    """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"""
    async with get_database_connection() as conn:
        result = await conn.fetch("SELECT 1")
        assert result[0][0] == 1
```

### 3. API —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API endpoints:

```python
def test_get_connections_api(client):
    """–¢–µ—Å—Ç API –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π"""
    response = client.get("/api/connections")
    assert response.status_code == 200
    assert "connections" in response.json()
```

### 4. Mock —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤:

```python
@patch('subprocess.run')
def test_execute_command_mock(mock_run):
    """–¢–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Å –º–æ–∫–æ–º"""
    mock_run.return_value = Mock(returncode=0, stdout=b"success")
    
    result = execute_command("test_command")
    assert result == "success"
```

---

## ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```python
import pytest
from unittest.mock import Mock, patch
from app.module import function_to_test

class TestModuleName:
    """–¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è ModuleName"""
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º"""
        self.test_data = {...}
    
    def test_function_name(self):
        """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"""
        # Arrange
        input_data = self.test_data
        
        # Act
        result = function_to_test(input_data)
        
        # Assert
        assert result == expected_value
    
    def test_function_name_edge_case(self):
        """–¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è"""
        # –¢–µ—Å—Ç —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        result = function_to_test({})
        assert result is None
    
    def test_function_name_error_handling(self):
        """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫"""
        with pytest.raises(ValueError):
            function_to_test(invalid_data)
```

### Async —Ç–µ—Å—Ç—ã

```python
import pytest
import asyncio

@pytest.mark.asyncio
async def test_async_function():
    """–¢–µ—Å—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏"""
    result = await async_function()
    assert result == expected_value

@pytest.mark.asyncio
async def test_async_function_with_mock():
    """–¢–µ—Å—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å –º–æ–∫–æ–º"""
    with patch('app.module.async_dependency') as mock_dep:
        mock_dep.return_value = Mock()
        result = await async_function()
        assert result == expected_value
```

### –§–∏–∫—Å—Ç—É—Ä—ã

```python
import pytest
from fastapi.testclient import TestClient
from app.main import app

@pytest.fixture
def client():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞"""
    return TestClient(app)

@pytest.fixture
def mock_database():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è –º–æ–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    with patch('app.database.get_connection') as mock:
        yield mock

@pytest.fixture
def sample_connection_data():
    """–§–∏–∫—Å—Ç—É—Ä–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
    return {
        "protocol": "tcp",
        "local_ip": "192.168.1.1",
        "local_port": 80,
        "remote_ip": "10.0.0.1",
        "remote_port": 12345,
        "state": "ESTABLISHED"
    }
```

---

## üé≠ –ú–æ–∫–∏ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –º–æ–∫–æ–≤

#### 1. –ú–æ–∫ subprocess

```python
@patch('subprocess.run')
def test_system_command(mock_run):
    mock_run.return_value = Mock(
        returncode=0,
        stdout=b"command output",
        stderr=b""
    )
    
    result = execute_system_command("test")
    assert result == "command output"
```

#### 2. –ú–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```python
@patch('asyncpg.connect')
async def test_database_operation(mock_connect):
    mock_conn = Mock()
    mock_conn.fetch.return_value = [{'id': 1, 'name': 'test'}]
    mock_connect.return_value.__aenter__.return_value = mock_conn
    
    result = await get_data_from_db()
    assert result[0]['name'] == 'test'
```

#### 3. –ú–æ–∫ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```python
@patch('socket.create_connection')
def test_network_connection(mock_socket):
    mock_socket.return_value = Mock()
    
    result = test_connection("localhost", 8080)
    assert result is True
```

#### 4. –ú–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```python
@patch('builtins.open', mock_open(read_data="file content"))
def test_file_reading():
    content = read_file("test.txt")
    assert content == "file content"
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã

```python
@patch('socket.create_connection')
def test_socket_context_manager(mock_socket):
    mock_socket_instance = Mock()
    mock_socket_instance.__enter__ = Mock(return_value=mock_socket_instance)
    mock_socket_instance.__exit__ = Mock(return_value=None)
    mock_socket.return_value = mock_socket_instance
    
    with create_socket_connection() as sock:
        result = sock.send(b"data")
        assert result == 4
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–ª–∞–≥–∏ pytest

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest -x

# –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
pytest -l

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
pytest --pdb

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
pytest --pdbcls=IPython.terminal.debugger:Pdb

# –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest --durations=10
```

### –û—Ç–ª–∞–¥–∫–∞ —Å print()

```python
def test_debug_with_print():
    data = complex_calculation()
    print(f"Debug: data = {data}")  # –ë—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ —Å —Ñ–ª–∞–≥–æ–º -s
    assert data > 0
```

### –û—Ç–ª–∞–¥–∫–∞ —Å pdb

```python
def test_debug_with_pdb():
    import pdb; pdb.set_trace()  # –¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞
    result = function_to_test()
    assert result == expected
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö

```python
import logging

def test_with_logging():
    logging.basicConfig(level=logging.DEBUG)
    logger = logging.getLogger(__name__)
    
    logger.debug("Debug message")
    logger.info("Info message")
    
    result = function_to_test()
    assert result is not None
```

---

## üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions

```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
    - name: Run tests
      run: |
        pytest --cov=app --cov-report=xml
    - name: Upload coverage
      uses: codecov/codecov-action@v1
```

### GitLab CI

```yaml
test:
  stage: test
  image: python:3.9
  script:
    - pip install -r requirements.txt
    - pytest --cov=app --cov-report=xml
  coverage: '/TOTAL.*\s+(\d+%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
```

### Jenkins Pipeline

```groovy
pipeline {
    agent any
    stages {
        stage('Test') {
            steps {
                sh 'pip install -r requirements.txt'
                sh 'pytest --cov=app --cov-report=xml'
            }
        }
        stage('Coverage') {
            steps {
                publishCoverage adapters: [coberturaAdapter('coverage.xml')]
            }
        }
    }
}
```

---

## üìã –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

```python
# ‚úÖ –•–æ—Ä–æ—à–æ
def test_parse_connection_data_with_valid_input():
def test_parse_connection_data_with_empty_input():
def test_parse_connection_data_with_invalid_format():

# ‚ùå –ü–ª–æ—Ö–æ
def test_parse():
def test_1():
def test_something():
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```python
# ‚úÖ –•–æ—Ä–æ—à–æ - AAA pattern
def test_function():
    # Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    input_data = {...}
    expected = {...}
    
    # Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    result = function_to_test(input_data)
    
    # Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    assert result == expected
```

### 3. –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```python
# ‚úÖ –•–æ—Ä–æ—à–æ - –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
def test_function_1():
    result = function_to_test(data1)
    assert result == expected1

def test_function_2():
    result = function_to_test(data2)
    assert result == expected2

# ‚ùå –ü–ª–æ—Ö–æ - —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
def test_function_1():
    global shared_data
    shared_data = data1
    result = function_to_test(shared_data)
    assert result == expected1

def test_function_2():
    global shared_data
    result = function_to_test(shared_data)  # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç test_function_1
    assert result == expected2
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
# ‚úÖ –•–æ—Ä–æ—à–æ - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
@pytest.fixture
def sample_data():
    return {"key": "value"}

def test_function_1(sample_data):
    result = function_to_test(sample_data)
    assert result is not None

def test_function_2(sample_data):
    result = another_function(sample_data)
    assert result is not None
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
# ‚úÖ –•–æ—Ä–æ—à–æ - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
def test_function_raises_exception():
    with pytest.raises(ValueError, match="Invalid input"):
        function_to_test(invalid_data)

def test_function_does_not_raise():
    try:
        result = function_to_test(valid_data)
        assert result is not None
    except Exception as e:
        pytest.fail(f"Unexpected exception: {e}")
```

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –¢–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∞—é—Ç

```bash
# –ó–∞–ø—É—Å–∫ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
pytest --timeout=30

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
pytest -s --tb=short
```

#### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å async —Ç–µ—Å—Ç–∞–º–∏

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
@pytest.mark.asyncio
async def test_async_function():
    result = await async_function()
    assert result == expected

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
def test_async_function():
    result = await async_function()  # –û—à–∏–±–∫–∞!
    assert result == expected
```

#### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –º–æ–∫–∞–º–∏

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –º–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è
@patch('app.module.external_function')
def test_with_mock(mock_function):
    mock_function.return_value = "mocked"
    result = function_to_test()
    assert result == "mocked"

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –º–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–±—ä–µ–∫—Ç–∞
def test_with_mock():
    with patch.object(instance, 'method') as mock:
        # –≠—Ç–æ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
        pass
```

#### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
@pytest.fixture
def db_session():
    with get_database_session() as session:
        yield session
        session.rollback()

def test_database_operation(db_session):
    # –¢–µ—Å—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç–∫–∞—Ç–æ–º
    pass
```

### –û—Ç–ª–∞–¥–∫–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ù–∞–π—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest --durations=10

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest --profile

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest -m "not slow"
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ pytest
pytest --cache-clear

# –û—á–∏—Å—Ç–∫–∞ Python –∫—ç—à–∞
find . -type d -name "__pycache__" -exec rm -rf {} +
find . -name "*.pyc" -delete

# –û—á–∏—Å—Ç–∫–∞ coverage
rm -rf .coverage htmlcov/
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [pytest Documentation](https://docs.pytest.org/)
- [pytest-asyncio](https://pytest-asyncio.readthedocs.io/)
- [pytest-mock](https://pytest-mock.readthedocs.io/)
- [pytest-cov](https://pytest-cov.readthedocs.io/)

### –ü–æ–ª–µ–∑–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
pip install pytest-xdist      # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
pip install pytest-benchmark  # –ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥
pip install pytest-html       # HTML –æ—Ç—á–µ—Ç—ã
pip install pytest-json-report # JSON –æ—Ç—á–µ—Ç—ã
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pytest --lf  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest --ff  # –°–Ω–∞—á–∞–ª–∞ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -x    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest -k    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∏–º–µ–Ω–∏ —Ç–µ—Å—Ç–∞
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
2. –ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏ pytest —Å —Ñ–ª–∞–≥–æ–º `-v` –∏–ª–∏ `-s`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ª–∞–¥—á–∏–∫ —Å —Ñ–ª–∞–≥–æ–º `--pdb`
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ pytest
5. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $(date)* 