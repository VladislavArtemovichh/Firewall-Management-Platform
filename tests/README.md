# üß™ –¢–µ—Å—Ç—ã –¥–ª—è Firewall Management Platform

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞–º–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py          # –ü–∞–∫–µ—Ç —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ conftest.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ test_models.py       # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ test_utils.py        # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
‚îú‚îÄ‚îÄ test_security.py     # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ test_api.py          # –¢–µ—Å—Ç—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_metrics.py      # –¢–µ—Å—Ç—ã –º–µ—Ç—Ä–∏–∫
‚îî‚îÄ‚îÄ README.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç
python run_tests.py all

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
python -m pytest tests/ -v --cov=app --cov-report=html:htmlcov
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
python run_tests.py unit

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
python run_tests.py integration

# –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö)
python run_tests.py fast

# –° –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
python run_tests.py coverage
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¢–µ—Å—Ç—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π:

- **models.py** - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è
- **utils.py** - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **security.py** - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **metrics.py** - –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫
- **routes.py** - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–∫—Ä—ã—Ç–∏—é

- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: **80%**
- –¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: **90%**

### –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º:

1. **HTML –æ—Ç—á–µ—Ç**: `htmlcov/index.html`
2. **–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç**: –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
3. **XML –æ—Ç—á–µ—Ç**: `coverage.xml` (–¥–ª—è CI/CD)

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å—ã –≤ –∏–∑–æ–ª—è—Ü–∏–∏:

- `test_models.py` - –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
- `test_utils.py` - –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
- `test_security.py` - –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `test_metrics.py` - –¢–µ—Å—Ç—ã –º–µ—Ç—Ä–∏–∫

### Integration —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

- `test_api.py` - –¢–µ—Å—Ç—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### –§–∏–∫—Å—Ç—É—Ä—ã

–í `conftest.py` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã:

- `sample_firewall_rule` - –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞
- `sample_firewall_device` - –¢–µ—Å—Ç–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `clear_login_attempts` - –û—á–∏—Å—Ç–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- `mock_time` - –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

## üè∑Ô∏è –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

```bash
# –¢–æ–ª—å–∫–æ –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m slow

# –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
pytest -m integration

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest -m "not integration"
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### pytest.ini

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ pytest:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—á–µ—Ç–æ–≤

### .coveragerc

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞:

- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å—Ç—Ä–æ–∫
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—á–µ—Ç–æ–≤

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```python
import pytest
from app.module import function

class TestFunction:
    """–¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ function"""
    
    def test_function_success(self):
        """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"""
        result = function("test_input")
        assert result == "expected_output"
    
    def test_function_error(self):
        """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏"""
        with pytest.raises(ValueError):
            function("invalid_input")
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
def test_with_fixture(sample_firewall_rule):
    """–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∏–∫—Å—Ç—É—Ä—ã"""
    assert sample_firewall_rule.name == "Test Rule"
```

### –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
from unittest.mock import patch, Mock

def test_with_mock():
    """–¢–µ—Å—Ç —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    with patch('app.module.external_function') as mock_func:
        mock_func.return_value = "mocked_result"
        result = function_under_test()
        assert result == "mocked_result"
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ò–º–ø–æ—Ä—Ç –æ—à–∏–±–∫–∏**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PYTHONPATH –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
3. **–í–Ω–µ—à–Ω–∏–µ API**: –í—Å–µ–≥–¥–∞ –º–æ–∫–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã

### –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v -s

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_module.py::TestClass::test_method

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
pytest --pdb
```

## üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions

```yaml
- name: Run tests
  run: |
    python -m pytest tests/ --cov=app --cov-report=xml
    coverage report --fail-under=80
```

### GitLab CI

```yaml
test:
  script:
    - python -m pytest tests/ --cov=app --cov-report=xml
    - coverage report --fail-under=80
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

- **–¶–µ–ª—å**: >80%
- **–¢–µ–∫—É—â–µ–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **Unit —Ç–µ—Å—Ç—ã**: <30 —Å–µ–∫—É–Ω–¥
- **Integration —Ç–µ—Å—Ç—ã**: <2 –º–∏–Ω—É—Ç
- **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä**: <5 –º–∏–Ω—É—Ç

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

- **–¶–µ–ª—å**: 100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ
- **–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å**: –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏

## ü§ù –í–∫–ª–∞–¥ –≤ —Ç–µ—Å—Ç—ã

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ —Å–Ω–∏–∂–∞–µ—Ç—Å—è
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [pytest-cov –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pytest-cov.readthedocs.io/)
- [unittest.mock –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python.org/3/library/unittest.mock.html) 